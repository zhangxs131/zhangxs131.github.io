<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>be_humble的个人空间</title>
  <icon>https://www.gravatar.com/avatar/c4ed6b24275933d93c8a2e1d1014e268</icon>
  <subtitle>张晓松的博客</subtitle>
  <link href="http://example.com/atom.xml" rel="self"/>
  
  <link href="http://example.com/"/>
  <updated>2022-06-26T13:10:24.982Z</updated>
  <id>http://example.com/</id>
  
  <author>
    <name>张晓松</name>
    <email>zhangxs131@163.com</email>
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>datasets库使用</title>
    <link href="http://example.com/2022/06/26/datasets%E4%BD%BF%E7%94%A8/"/>
    <id>http://example.com/2022/06/26/datasets%E4%BD%BF%E7%94%A8/</id>
    <published>2022-06-26T08:20:00.000Z</published>
    <updated>2022-06-26T13:10:24.982Z</updated>
    
    <content type="html"><![CDATA[<p>Huggingface的datasets类，保护一些场景数据集和metric</p><span id="more"></span><h4 id="load-dataset"><a href="#load-dataset" class="headerlink" title="load_dataset"></a>load_dataset</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> datasets <span class="keyword">import</span> load_dataset</span><br><span class="line"></span><br><span class="line">data=load_dataset(<span class="string">&#x27;dataset_name&#x27;</span>,<span class="string">&#x27;sub_name&#x27;</span>,split=<span class="string">&#x27;train..&#x27;</span>)</span><br></pre></td></tr></table></figure><p>得到Dataset类的实例</p><p>num_rows查看行数</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">dataset[&#x27;train&#x27;].num_rows</span><br><span class="line">#3668</span><br></pre></td></tr></table></figure><p>下面包括features类和数据</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">dataset[<span class="string">&#x27;train&#x27;</span>].features</span><br><span class="line"><span class="comment">#&#123;&#x27;idx&#x27;: Value(dtype=&#x27;int32&#x27;, id=None),</span></span><br><span class="line"><span class="comment"># &#x27;label&#x27;: ClassLabel(num_classes=2, names=[&#x27;not_equivalent&#x27;, #&#x27;equivalent&#x27;], id=None),</span></span><br><span class="line"><span class="comment"># &#x27;sentence1&#x27;: Value(dtype=&#x27;string&#x27;, id=None),</span></span><br><span class="line"><span class="comment"># &#x27;sentence2&#x27;: Value(dtype=&#x27;string&#x27;, id=None)&#125;</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#查看数据类型</span></span><br><span class="line">dataset[<span class="string">&#x27;train&#x27;</span>].features[<span class="string">&#x27;idx&#x27;</span>]</span><br><span class="line"><span class="comment">#Value(dtype=&#x27;int32&#x27;, id=None)</span></span><br><span class="line"></span><br><span class="line">dataset[<span class="string">&#x27;train&#x27;</span>].features[<span class="string">&#x27;label&#x27;</span>]</span><br><span class="line"><span class="comment">#ClassLabel(num_classes=2, names=[&#x27;not_equivalent&#x27;, &#x27;equivalent&#x27;], id=None)</span></span><br><span class="line"></span><br><span class="line">dataset[<span class="string">&#x27;train&#x27;</span>].features[<span class="string">&#x27;sentence1&#x27;</span>]</span><br><span class="line"><span class="comment">#Value(dtype=&#x27;string&#x27;, id=None)</span></span><br><span class="line"></span><br><span class="line">dataset[<span class="string">&#x27;train&#x27;</span>].features[<span class="string">&#x27;label&#x27;</span>].names</span><br></pre></td></tr></table></figure><ul><li>set_format() 设置喂给模型的数据，类型</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">set_format(<span class="built_in">type</span>=<span class="string">&#x27;torch&#x27;</span>,columns=[<span class="string">&#x27;idx&#x27;</span>,<span class="string">&#x27;labels&#x27;</span>])</span><br></pre></td></tr></table></figure><h5 id="Local-and-remote-files"><a href="#Local-and-remote-files" class="headerlink" title="Local and remote files"></a>Local and remote files</h5><p>加载本地文件csv,text,jsonlines，json</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> datasets <span class="keyword">import</span> load_dataset</span><br><span class="line"></span><br><span class="line">dataset=load_dataset(<span class="string">&#x27;csv&#x27;</span>,data_files=<span class="string">&#x27;my_file.csv&#x27;</span>)</span><br><span class="line"></span><br><span class="line">data=load_dataset(<span class="string">&#x27;json&#x27;</span>,data_files=<span class="string">&#x27;my_file.json&#x27;</span>,field=<span class="string">&#x27;data&#x27;</span>)</span><br></pre></td></tr></table></figure><p>加载remote file,csv ,zipped.csv</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">base_url=<span class="string">&quot;https://huggingface.co/datasets/lhoestq/demo1/resolve/main/data/&quot;</span></span><br><span class="line"></span><br><span class="line">dataset=load_dataset(<span class="string">&#x27;csv&#x27;</span>.data_files=&#123;<span class="string">&#x27;train&#x27;</span>:base_url+<span class="string">&#x27;train.csv&#x27;</span>&#125;)</span><br></pre></td></tr></table></figure><h4 id="load-dataset-builder"><a href="#load-dataset-builder" class="headerlink" title="load_dataset_builder"></a>load_dataset_builder</h4><p>在download之前，查看数据集的dataset card</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> datasets <span class="keyword">import</span> load_dataset_builder</span><br><span class="line">dataset_builder=load_dataset_builder(<span class="string">&#x27;imdb&#x27;</span>)</span><br><span class="line"><span class="comment">#查看cache地址</span></span><br><span class="line">dataset_builder.cache_dir</span><br><span class="line"><span class="comment">#查看info.features</span></span><br><span class="line">dataset_builder.info.features</span><br><span class="line"><span class="comment">#查看split</span></span><br><span class="line">dataset_builder.info.splits</span><br></pre></td></tr></table></figure><h4 id="get-dataset-config-names"><a href="#get-dataset-config-names" class="headerlink" title="get_dataset_config_names"></a>get_dataset_config_names</h4><p>获取subset的名字</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> datasets <span class="keyword">import</span> get_dataset_config_names</span><br><span class="line"></span><br><span class="line">config=get_dataset_config_names(<span class="string">&#x27;glue&#x27;</span>)</span><br><span class="line">config</span><br></pre></td></tr></table></figure><h4 id="Dataset"><a href="#Dataset" class="headerlink" title="Dataset"></a>Dataset</h4><ul><li>dataset.info</li><li>dataset.split &#x2F; description&#x2F; citation&#x2F;homepage</li><li>dataset.shape</li><li>dataset.num_columns</li><li>dataset.num_rows</li><li>dataset.column_names</li><li>dataset.features</li></ul><h5 id="load-memory中数据"><a href="#load-memory中数据" class="headerlink" title="load memory中数据"></a>load memory中数据</h5><ul><li>Dataset.from_dict()</li><li>Dataset.from_pandas()</li></ul><h5 id="处理数据"><a href="#处理数据" class="headerlink" title="处理数据"></a>处理数据</h5><ul><li>dataset.sort(‘label’)</li><li>dataset.shuffle(seed&#x3D;42)</li><li>dataset.select([0,10,20,…])</li><li>dataset.filter(lambda example:example[‘sentence1’.startswith(‘A’)])</li><li>dataset.train_test_split(test_size&#x3D;0.1) 默认shuffle，可以设置shuffle&#x3D;False</li><li>dataset.shard(num_shards&#x3D;4,index&#x3D;0)  划分为4份数据，选择0份</li></ul><h5 id="数据columns处理"><a href="#数据columns处理" class="headerlink" title="数据columns处理"></a>数据columns处理</h5><ul><li><p>dataset.rename_column(‘sentenc1’,’s1’)</p></li><li><p>dataset.remove_column(‘label’)</p><p>修改column数据类型</p></li><li><p>dataset.cast(new_features) new_features&#x3D;data.features.copy()</p></li><li><p>dataset.cast_column(‘audio’,Audio(sampling_rate&#x3D;16000))</p></li><li><p>dataset.flatten() 展平嵌套结构数据</p></li></ul><h5 id="Map"><a href="#Map" class="headerlink" title="Map"></a>Map</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">data=dataset.<span class="built_in">map</span>(<span class="keyword">lambda</span> example:&#123;<span class="string">&#x27;new&#x27;</span>:example[<span class="string">&#x27;s1&#x27;</span>]&#125;,remove_columns=[<span class="string">&#x27;s1&#x27;</span>])</span><br></pre></td></tr></table></figure><h5 id="连接数据集"><a href="#连接数据集" class="headerlink" title="连接数据集"></a>连接数据集</h5><p>columns名相同则可以连接</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> datasets <span class="keyword">import</span> concatenate_datasets</span><br><span class="line"></span><br><span class="line">data=concatenate_datasets([bookcorpus,wiki])</span><br></pre></td></tr></table></figure><h5 id="save"><a href="#save" class="headerlink" title="save"></a>save</h5><ul><li>dataset.to_csv()</li><li>dataset.to_json()</li><li>dataset.to_pandas()</li><li>dataset.to_dict()</li></ul><h4 id="list-metrics"><a href="#list-metrics" class="headerlink" title="list_metrics"></a>list_metrics</h4><p>查看全部的metrics</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> datasets <span class="keyword">import</span> list_metrics</span><br><span class="line">metrics_list=list_metrics</span><br><span class="line">metrics_list</span><br><span class="line"></span><br><span class="line">[<span class="string">&#x27;accuracy&#x27;</span>, <span class="string">&#x27;bertscore&#x27;</span>, <span class="string">&#x27;bleu&#x27;</span>, <span class="string">&#x27;bleurt&#x27;</span>, <span class="string">&#x27;cer&#x27;</span>, <span class="string">&#x27;comet&#x27;</span>, <span class="string">&#x27;coval&#x27;</span>, <span class="string">&#x27;cuad&#x27;</span>, <span class="string">&#x27;f1&#x27;</span>, <span class="string">&#x27;gleu&#x27;</span>, <span class="string">&#x27;glue&#x27;</span>, <span class="string">&#x27;indic_glue&#x27;</span>, <span class="string">&#x27;matthews_correlation&#x27;</span>, <span class="string">&#x27;meteor&#x27;</span>, <span class="string">&#x27;pearsonr&#x27;</span>, <span class="string">&#x27;precision&#x27;</span>, <span class="string">&#x27;recall&#x27;</span>, <span class="string">&#x27;rouge&#x27;</span>, <span class="string">&#x27;sacrebleu&#x27;</span>, <span class="string">&#x27;sari&#x27;</span>, <span class="string">&#x27;seqeval&#x27;</span>, <span class="string">&#x27;spearmanr&#x27;</span>, <span class="string">&#x27;squad&#x27;</span>, <span class="string">&#x27;squad_v2&#x27;</span>, <span class="string">&#x27;super_glue&#x27;</span>, <span class="string">&#x27;wer&#x27;</span>, <span class="string">&#x27;wiki_split&#x27;</span>, <span class="string">&#x27;xnli&#x27;</span>]</span><br></pre></td></tr></table></figure><h4 id="load-metric"><a href="#load-metric" class="headerlink" title="load_metric"></a>load_metric</h4><p>加载metric进行评测</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> datasets <span class="keyword">import</span> load_metric</span><br><span class="line">metric = load_metric(<span class="string">&#x27;glue&#x27;</span>, <span class="string">&#x27;mrpc&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#查看输入输出</span></span><br><span class="line">metric.inputs_description</span><br><span class="line"></span><br><span class="line"><span class="comment">#使用</span></span><br><span class="line">result=metric.compute(prediction,reference)</span><br><span class="line"></span><br><span class="line"><span class="comment">#batch</span></span><br><span class="line">metric.add_batch(prediction,reference)</span><br><span class="line">metric.compute()</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;p&gt;Huggingface的datasets类，保护一些场景数据集和metric&lt;/p&gt;</summary>
    
    
    
    
    <category term="api" scheme="http://example.com/tags/api/"/>
    
  </entry>
  
  <entry>
    <title>Hello World</title>
    <link href="http://example.com/2022/05/22/hello-world/"/>
    <id>http://example.com/2022/05/22/hello-world/</id>
    <published>2022-05-22T07:49:17.315Z</published>
    <updated>2022-05-22T07:49:17.315Z</updated>
    
    <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;Welcome to &lt;a href=&quot;https://hexo.io/&quot;&gt;Hexo&lt;/a&gt;! This is your very first post. Check &lt;a href=&quot;https://hexo.io/docs/&quot;&gt;documentation&lt;/a&gt; for</summary>
      
    
    
    
    
  </entry>
  
</feed>
